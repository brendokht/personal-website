---
import MobileNavItem from "./MobileNavItem.astro";
import NavItem from "./NavItem.astro";
---

<!-- Medium screen navbar -->
<nav
    class="flex flex-row justify-between px-6 py-2 drop-shadow-lg z-10 fixed w-full bg-white dark:bg-black"
>
    <span
        class="text-4xl font-bold hover:rotate-[360deg] transition-transform duration-500 ease-in-out"
        ><a href="/">BK</a></span
    >
    <div class="hidden md:flex items-center">
        <ul
            class="hidden md:flex flex-row justify-evenly w-full md:mx-auto md:items-center md:space-x-20 lg:space-x-28"
        >
            <NavItem href="/" text="Home" />
            <NavItem href="/about/" text="About" />
            <NavItem href="/projects/" text="Projects" />
            <NavItem href="/contact/" text="Contact" />
            <li>
                <span
                    id="themeToggle"
                    class="cursor-pointer bg-none border-0 p-2 rounded-md transition-colors duration-200 ease-in-out hover:bg-neutral-300 dark:hover:bg-neutral-500"
                >
                    <svg
                        id="sun"
                        class="hidden dark:inline-block"
                        xmlns="http://www.w3.org/2000/svg"
                        height="24px"
                        fill="#ffffff"
                        viewBox="0 -960 960 960"
                        width="24px"
                    >
                        <path
                            d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z"
                        ></path>
                    </svg>
                    <svg
                        id="moon"
                        class="inline-block dark:hidden"
                        xmlns="http://www.w3.org/2000/svg"
                        height="24px"
                        fill="#000000"
                        viewBox="0 -960 960 960"
                        width="24px"
                        ><path
                            d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z"
                        ></path></svg
                    >
                </span>
            </li>
        </ul>
    </div>
    <div class="md:hidden">
        <div
            class="navbar-burger cursor-pointer inline-flex items-center hover:bg-neutral-300 dark:hover:bg-neutral-500 rounded-md p-2"
        >
            <button aria-label="Open menu button"
                ><svg
                    class="fill-black dark:fill-white"
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    viewBox="0 -960 960 960"
                    width="24px"
                    ><path
                        d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"
                    ></path></svg
                ></button
            >
        </div>
        <div
            class="navbar-close cursor-pointer hidden items-center hover:bg-neutral-300 dark:hover:bg-neutral-500 rounded-md p-2"
        >
            <button aria-label="Close menu button"
                ><svg
                    class="fill-black dark:fill-white"
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    viewBox="0 -960 960 960"
                    width="24px"
                    ><path
                        d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"
                    ></path></svg
                ></button
            >
        </div>
    </div>
</nav>

<!-- Mobile menu -->
<div
    class="navbar-menu fixed drop-shadow-lg invisible mb-5 bg-white dark:bg-black w-full z-20 mt-12"
>
    <ul>
        <MobileNavItem href="/" text="Home" />
        <MobileNavItem href="/about/" text="About" />
        <MobileNavItem href="/projects/" text="Projects" />
        <MobileNavItem href="/contact/" text="Contact" />
        <li
            class="text-lg p-0 h-14 my-2 cursor-pointer hover:bg-neutral-300 dark:hover:bg-neutral-500 hover:rounded-md"
        >
            <span
                id="themeToggleMobile"
                class="m-0 flex items-center pl-6 h-full w-full bg-none border-0"
            >
                <svg
                    id="sun"
                    class="hidden dark:inline-block"
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    fill="#ffffff"
                    viewBox="0 -960 960 960"
                    width="24px"
                >
                    <path
                        d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Zm326-268Z"
                    ></path>
                </svg>
                <svg
                    id="moon"
                    class="inline-block dark:hidden"
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    fill="#000000"
                    viewBox="0 -960 960 960"
                    width="24px"
                    ><path
                        d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z"
                    ></path></svg
                >
            </span>
        </li>
    </ul>
</div>

<script is:inline>
    document.addEventListener("DOMContentLoaded", function () {
        const burger = document.querySelector(".navbar-burger");
        const menu = document.querySelector(".navbar-menu");
        const close = document.querySelector(".navbar-close");
        const themeToggleMobile = document.querySelector("#themeToggleMobile");
        const themeToggle = document.querySelector("#themeToggle");

        if (burger && menu && close) {
            burger.addEventListener("click", function () {
                menu.classList.toggle("invisible");
                this.classList.toggle("hidden");
                close.classList.toggle("hidden");
                // done to avoid issues with hidden and inline-flex being together
                close.classList.toggle("inline-flex");
            });

            close.addEventListener("click", function () {
                menu.classList.toggle("invisible");
                burger.classList.toggle("hidden");
                this.classList.toggle("hidden");
                // done to avoid issues with hidden and inline-flex being together
                this.classList.toggle("inline-flex");
            });

            window.addEventListener("resize", function () {
                if (
                    this.innerWidth >= 768 &&
                    !menu.classList.contains("invisible")
                ) {
                    menu.classList.toggle("invisible");
                    burger.classList.toggle("hidden");
                    close.classList.toggle("hidden");
                }
            });
        }

        const theme = (() => {
            if (
                typeof localStorage !== "undefined" &&
                localStorage.getItem("theme")
            ) {
                return localStorage.getItem("theme") ?? "light";
            }
            if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
                return "dark";
            }
            return "light";
        })();

        if (theme === "light") {
            document.documentElement.classList.remove("dark");
        } else {
            document.documentElement.classList.add("dark");
        }

        window.localStorage.setItem("theme", theme);

        if (themeToggle && themeToggleMobile) {
            const handleToggleClick = () => {
                const element = document.documentElement;
                element.classList.toggle("dark");

                const isDark = element.classList.contains("dark");
                localStorage.setItem("theme", isDark ? "dark" : "light");
            };

            themeToggle.addEventListener("click", handleToggleClick);
            themeToggleMobile.addEventListener("click", handleToggleClick);
        }
    });
</script>
